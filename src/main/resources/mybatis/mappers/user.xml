<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="user">

	<!-- 로그인 user 정보 가져오기 (id password) -->
	<select id="selectOneByIdPw" parameterType="com.javaex.vo.UserVO" resultType="com.javaex.vo.UserVO">
		<![CDATA[
			select user_id as userId,
		   		   user_name as userName,
		   		   login_id as loginId,
		   		   role
			from users
			where login_id = #{loginId}
			and password = #{password}
		]]>
	</select>

	<!-- 회원의 담당 트레이너 조회 -->
	<select id="selectTrainerByMemberId" parameterType="int" resultType="map">
		select u.user_id AS trainerId,
		       u.user_name AS trainerName
		from users u
		join pt_contract pc on u.user_id = pc.trainer_id
		where pc.member_id = #{memberId}
		limit 1
	</select>
	
	<select id="selectMembersByTrainerId" parameterType="int" resultType="com.javaex.vo.UserVO">
        select u.user_id as userId,
               u.user_name as userName,
               u.phone_number as phoneNumber
        from users u
        join pt_contract pc on u.user_id = pc.member_id
        where pc.trainer_id = #{trainerId}
        order by u.user_name ASC
    </select>  

	<!-- 트레이너와 회원이 pt_members 테이블에 연결되어 있는지 확인,보안용 -->
    <select id="checkMemberAssignment" parameterType="map" resultType="int">
        select count(*)
        from pt_contract
        where member_id = #{memberId}
        and trainer_id = #{trainerId}
    </select>

	<!-- user_id로 사용자의 기본 정보를 조회하는 쿼리 -->
    <select id="selectUserByNo" parameterType="int" resultType="com.javaex.vo.UserVO">
        select user_id as userId,
               user_name as userName,
               role
        from users
        where user_id = #{userId}
    </select>
    
    

</mapper>