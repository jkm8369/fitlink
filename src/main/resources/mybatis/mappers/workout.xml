<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="workout">

	<!-- 운동일지 리스트 가져오기 -->
	<select id="workoutSelectList" parameterType="com.javaex.vo.WorkoutVO" resultType="com.javaex.vo.WorkoutVO">
		<![CDATA[
			select wl.log_id as logId,
				   wl.user_id as userId,
				   wl.user_exercise_id as userExerciseId,
				   e.exercise_name as exerciseName,
				   e.body_part as bodyPart,
				   wl.weight,
				   wl.reps,
				   wl.log_date as logDate
			from workout_log wl
			left join selected_exercises se
				   on wl.user_exercise_id = se.user_exercise_id
			left join exercise e
				   on se.exercise_id = e.exercise_id
			where wl.user_id = #{userId}
			order by wl.log_id desc
		]]>
	</select>
	
	<!-- 운동 1개 조회 -->
	<select id="workoutSelectOne" parameterType="com.javaex.vo.WorkoutVO" resultType="com.javaex.vo.WorkoutVO">
		select wl.log_id as logId,
			   wl.user_id as userId,
			   wl.user_exercise_id as userExerciseId,
			   e.exercise_name as exerciseName,
			   e.body_part as bodyPart,
			   wl.weight,
			   wl.reps,
			   wl.log_date as logDate
		from workout_log wl
		left join selected_exercises se
			   on wl.user_exercise_id = se.user_exercise_id
		left join exercise e
			   on se.exercise_id = e.exercise_id
		where wl.log_id = #{logId}
	</select>
	
	
	<!-- 운동 기록 추가 키 가져오기 -->
	<insert id="insertKey" parameterType="com.javaex.vo.WorkoutVO">
		<![CDATA[
			insert into workout_log
			(log_date, weight, reps, created_at, log_type, user_id, user_exercise_id, writer_id)
			values(null, 
				   #{logDate}, 
				   #{weight}, 
				   #{reps}, 
				   now(), 
				   #{logType}, 
				   #{userId}, 
				   #{userExerciseId},
				   #{writerId})
		]]>
		
		<selectKey keyProperty="logId" resultType="int" order="AFTER">
			<![CDATA[
				select last_insert_id()
			]]>
		</selectKey>
	
	</insert>
	
	
	<!-- 운동 기록 삭제 -->
	<delete id="workoutRemove" parameterType="int">
		delete 
		from workout_log
		where log_Id = #{logId}
	</delete>
	
	

</mapper>